<!DOCTYPE html>
<html lang="ko">
    <head>
        <%- include('../include/head', {title: '로그인'}) %>
        <link rel="stylesheet" href="/static/css/login.css" />
    </head>
    <body>
        <div class="login-box">
            <h1>로그인</h1>
            <p>
                참고! 아이디는 <b>admin</b>이고<br />
                비밀번호는 <b>12345678</b>입니다.
            </p>

            <!-- 폼전송으로 로그인 진행 -->

            <form name="form_login">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="id">ID</span>
                    <input
                        type="text"
                        class="form-control"
                        aria-label="id input"
                        aria-describedby="id"
                        name="id"
                    />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="pw">PW</span>
                    <input
                        type="password"
                        class="form-control"
                        aria-label="pw input"
                        aria-describedby="pw"
                        name="pw"
                    />
                </div>
                <div class="errorMsg"></div>

                <button type="button" class="btn btn-dark" onclick="login()">Login</button>
                <br />
                <a href="/">Home 이동하기</a>
            </form>
        </div>

        <script>
            function login() {
                const form = document.forms["form_login"];
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                axios({
                    url: "/admin/loginAdmin",
                    method: "POST",
                    data: {
                        id: form.id.value,
                        pw: form.pw.value,
                    },
                })
                    .then((res) => {
                        const { isSuccess, isLogin } = res.data;

                        if (isLogin && isSuccess) {
                            window.location.href = "/admin/restaurants";
                        } else if (isLogin && !isSuccess) {
                            alert("접근 권한이 없습니다.");
                            window.location.href = "/";
                        } else {
                            form.reset();
                            const msg = document.querySelector(".errorMsg");
                            msg.classList.toggle(".errorMsg");
                            msg.innerHTML =
                                "<p>로그인에 실패했습니다<br />아이디, 비밀번호를 다시 확인해주세요.</p>";
                        }
                    })
                    .catch((err) => console.log(err));
            }
        </script>
    </body>
</html>
