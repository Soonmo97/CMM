<link rel="stylesheet" href="/static/css/header.css" />
<header>
    <div class="container">
        <div>
            <a href="">
                <img class="logo" src="../static/images/CMM.png" alt=""
                    style="width: auto; height: 200px; margin-bottom: 20px; flex: 0 0 auto" />
            </a>
        </div>
        <div>
            <div class="search" style="width: 500px; margin-top: 0px; flex: 1">
                <div class="collapse navbar-collapse d-flex justify-content-center" id="navbarSupportedContent">
                    <div class="d-flex" role="search" style="width: 500px">
                        <input class="form-control me-2" type="search" placeholder="search" aria-label="Search" id="" />
                        <button class="btn" type="button" id="">
                            <img src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png" />
                        </button>
                    </div>
                </div>
            </div>
            <br />
            <div>
                <nav class="menu" style="flex: 0 0 auto; margin-top: -30px">
                    <ul>
                        <li class="active"><a href="#">홈</a></li>
                        <li><a href="#">한식</a></li>
                        <li><a href="#">일식</a></li>
                        <li><a href="#">양식</a></li>
                        <li><a href="#">중식</a></li>
                        <li><a href="#">디저트</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="buttons">
            <!-- 로그인 유무에 따른 헤더 변경 -->
            <%if (isLogin) { %>
                <p>
                    <%= user %>님 환영합니다.
                </p>
                <form name="form_logout" action="/form/logout" method="post">
                    <button id="logoutBtn" class="signBtn" type="submit">로그아웃</button>
                </form>

                <% } else { %>

                    <button id="signupBtn" class="signBtn">회원가입</button>
                    <button id="loginBtn" class="signBtn">로그인</button>
                    <% } %>
        </div>
    </div>

    <!-- 로그인 팝업창 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>로그인</h2>
            <div>
                <img src="../static/images/CMM.png" width="150px" height="200px" />
            </div>
            <a href=""><span class="signupLabel" id="closeModalBtn">닫기</span></a>

            <form name="form_info" action="/index" method="post">
                <input type="hidden" name="nickname" />
            </form>

            <form id="modal_login" action="/form/login" method="post">
                <!-- 아이디 -->
                <div>
                    <h3>
                        <label for="id">아이디</label>
                    </h3>
                    <span class="box intId">
                        <input type="text" name="id" class="int" maxlength="20" />
                    </span>
                    <!-- <span class="error_next_box"></span> -->
                </div>

                <!-- 비밀번호 -->
                <div>
                    <h3>
                        <label for="pswd1">비밀번호</label>
                    </h3>
                    <span class="box intPw">
                        <input type="password" name="pw" class="int" maxlength="20" />
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 로그인-->
                <div class="btnArea">
                    <button type="submit" id="btnJoin">
                        <span>로그인</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 회원가입 팝업창 -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <h2>회원가입</h2>
            <div>
                <img src="../static/images/CMM.png" width="150px" height="200px" />
            </div>
            <a href=""><span class="signupLabel" id="closeModalBtn">닫기</span></a>
            <!-- <form id="modal_register" name="modal_register" action="/form/register" method="post"> -->
            <form id="modal_register" name="modal_register">
                <!-- 아이디 -->
                <div>
                    <h3>
                        <label for="id">아이디</label>
                    </h3>
                    <span class="box intId">
                        <input type="text" name="id" id="inputId" class="int" maxlength="20" onkeydown="inputIdCk()" required />
                        <!-- 타입을 btn에서 input으로 수정 -->
                        <span class="stepbutton">
                            <button id="btnCheckId" onclick="idCheck()">중복확인</button>
                            <input type="hidden" name="idDuplication" id="idDuplication" value="idUncheck">
                        </span>
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 비밀번호 -->
                <div>
                    <h3>
                        <label for="pswd1">비밀번호</label>
                    </h3>
                    <span class="box intPw">
                        <input type="password" name="pw" class="int" maxlength="20" id=pw required />
                        <span id="alertTxt">사용불가</span>
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 비밀번호 확인 -->
                <div>
                    <h3>
                        <label for="pswd2">비밀번호 재확인</label>
                    </h3>
                    <span class="box intPwCheck">
                        <input type="password" name="pwCheck" class="int" maxlength="20" id=pwCk />
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 닉네임 -->
                <div>
                    <h3>
                        <label for="name">닉네임</label>
                    </h3>
                    <span class="box intName">
                        <input type="text" name="nickname" class="int" maxlength="20" placeholder="7글자 이하로 작성해주세요."
                            required />
                        <span class="stepbutton"><button type="button" id="btnCheckName">중복확인</button></span>
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 이메일 -->
                <!-- <form id="checkEmail" action="/checkEmail" method="POST"></form> -->
                <!-- form 안에 form 작성불가 -->
                <div>
                    <h3>
                        <label for="email">이메일</label>
                    </h3>
                    <span class="box intEmail">
                        <input type="email" name="email" class="int" maxlength="100" required />
                        <span class="stepbutton"><button type="button" id="btnCheckCode">확인코드전송</button></span>
                    </span>
                    <span class="error_next_box">이메일 주소를 다시 확인해주세요.</span>
                </div>

                <!-- 이메일 확인 -->
                <!-- 태그명, 변수명 오류 있습니다!!!!!!! 제 임의로 바꿔놓았습니다!! -->
                
                <div>
                    <h3>
                        <label for="email">이메일 확인</label>
                    </h3>
                    <span class="box intName">
                        <input type="email" id="emailChk" name="emailChk" class="int" maxlength="20" />
                        <span class="stepbutton"><button type="button" id="btnCheckEmail">확인</button></span>
                    </span>
                    <span class="error_next_box"></span>
                </div>
                <!-- 회원가입-->
                <div class="btnArea">
                    <button type="submit" id="btnJoin">
                        <span>가입하기</span>
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- 비밀번호 재확인 부분 -->
    <script>
        let pw = document.getElementById("pw");
        let pwCk = document.getElementById("pwCk");

        function validatePassword() {
            if (pw.value != pwCk.value) {
                pwCk.setCustomValidity("비밀번호가 같지 않습니다.");
            }
            else {
                pwCk.setCustomValidity('');
            }
        }

        pw.onchange = validatePassword;
        pwCk.onkeyup = validatePassword;
    </script>

    <!-- 아이디 중복화면 검사 -->
    <script>
        // 아이디 중복체크 화면 열기
        function idCheck() {
            window.name = "parentForm";
            window.open("/user/idCheckForm", "chkForm", "width=500, height=300, resizable=no, scrollbars=no");

        }
        // 중복체크 후 다시 새로운 아이디를 입력했을 때 다시 중복체크 하도록 함
        function inputIdCk() {
            document.modal_register.idDuplication.value = "idUncheck";
        }
    </script>

    <!-- 회원가입 입력값 검사 -->
    <script>
        document.getElementById("modal_register").addEventListener('submit', function (event) {
            event.preventDefault();

            const form = document.forms["modal_register"];

            // if (!form.checkValidity()) {
            //     form.reportValidity();
            //     return;
            // }

            if (form.idDuplication.value != "idCheck") {
                alert("아이디 중복체크를 해주세요.");
                return false;
            }

            axios({
                method: "POST",
                url: "/form/register",
                data: {
                    id: form.id.value,
                    pw: form.pw.value,
                    nickname: form.nickname.value,
                    email: form.email.value,
                },
            })
                .then((result) => {
                    if (result) {
                        console.log("응답 데이터", result.id); // undefined
                        alert("회원가입 성공!");
                        document.location.href = "/";
                    }
                    else {
                        alert("중복된 아이디 입니다!");
                        res.end();
                    }
                })
                .catch((err) => {
                    console.error(error);
                    res.status(500).send('회원가입 실패');
                })
        });
    </script>


    <!-- 어두운 오버레이 -->
    <div id="overlay"></div>

    <script>
        (() => {
            // 회원가입 버튼 클릭 이벤트 처리
            document.getElementById("signupBtn").addEventListener("click", function () {
                // 팝업창과 어두운 오버레이 표시
                document.getElementById("signupModal").style.display = "block";
                document.getElementById("overlay").style.display = "block";
            });

            // 모달 닫기 버튼 클릭 이벤트 처리
            document.getElementById("closeModalBtn").addEventListener("click", function () {
                // 팝업창과 어두운 오버레이 숨기기
                document.getElementById("signupModal").style.display = "none";
                document.getElementById("overlay").style.display = "none";
            });

            // 로그인 버튼 클릭 이벤트 처리
            document.getElementById("loginBtn").addEventListener("click", function () {
                // 팝업창과 어두운 오버레이 표시
                document.getElementById("loginModal").style.display = "block";
                document.getElementById("overlay").style.display = "block";
            });

            // 모달 닫기 버튼 클릭 이벤트 처리
            document.getElementById("closeModalBtn").addEventListener("click", function () {
                // 팝업창과 어두운 오버레이 숨기기
                document.getElementById("loginModal").style.display = "none";
                document.getElementById("overlay").style.display = "none";
            });
        })();
    </script>
</header>