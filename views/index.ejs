<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>창동 맛집 모음</title>
        <link rel="stylesheet" href="/static/css/index.css" />
        <!-- head include -->
        <%- include('./include/head') %>
    </head>
    <body>
        <!-- header include -->
        <%- include('./include/header') %>
        <div
            style="
                padding-top: 100px;
                display: flex;
                justify-content: center;
                gap: 20px;
                text-align: center;
            "
        >
            <img src="/static/images/CMM.png" alt="" style="width: 70px; height: auto" />
            <h1>모든식당</h1>
        </div>

        <div style="width: 1350px; margin: 0 auto">
            <div style="max-width: 1350px; margin: 0 auto">
                <div class="restaurantMenu" id="restaurantMenu1" style="padding-top: 50px">
                    <div
                        class="restaurantContainer"
                        style="
                            display: grid;
                            grid-template-columns: repeat(3, minmax(0, 1fr));
                            gap: 20px;
                            justify-items: center;
                        "
                    >
                        <% for (let i = 0; i <restaurants.length; i++) { %>
                        <div class="restaurantItem" style="max-width: 410px">
                            <a href="/restaurantDetail/<%=restaurants[i].rest_index%>">
                                <div class="imageContainer">
                                    <img
                                        src="/static/images/<%= restaurants[i].rest_index %>.png"
                                        alt="Restaurant 1"
                                        class="RestaurantImage"
                                        style="width: 300px; height: 300px"
                                    />
                                    <span class="label"><%= restaurants[i].rest_name %></span>
                                    <span class="labelStar">리뷰</span>
                                </div>
                            </a>
                        </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <br /><br />
        <!-- <div>
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <li class="page-item disabled">
                        <a class="page-link">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div> -->

        <!-- footer include -->
        <%- include('./include/footer') %>
        <script>
            // 검색 버튼에 이벤트 리스너 추가
            document.getElementById("searchButton").addEventListener("click", searchKeyword);

            // 키워드로 검색하여 테이블을 채우는 함수
            async function searchKeyword() {
                try {
                    const keyword = document.getElementById("searchInput").value.trim(); // 입력값의 앞뒤 공백 제거
                    if (!keyword) {
                        return; // 검색어가 없으면 함수 종료
                    }
                    document.location.href = `/search?keyword=${keyword}`;
                } catch (error) {
                    console.error("데이터 가져오기 오류:", error);
                }
            }

            // 엔터 키 입력 시 검색 실행
            document.getElementById("searchInput").addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    searchKeyword();
                }
            });
        </script>

        <!-- 무한 스크롤 작업 -->

        <script>
            // 무한 스크롤 기능
            window.addEventListener("scroll", function() {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
                loadMoreData();
            }
            });

            async function loadMoreData() {
            try {
                // axios를 사용하여 서버에 추가 데이터 요청 보내기
                const response = await axios.get('/');
                const newData = response.data.restaurants;

                console.log("무한 스크롤 작업 중.. " , response.data.restaurants);

                // 받은 데이터를 이용하여 화면에 추가하는 작업 수행
                restaurants.forEach(restaurants => {
                const restaurantItem = document.createElement('div');
                restaurantItem.classList.add('restaurantItem');
                restaurantItem.innerHTML = `
                <a href="/restaurantDetail/${restaurants.rest_index}">
                <div class="imageContainer">
                    <img src="/static/images/${restaurants.rest_index}.png" alt="${restaurants.rest_name}" class="RestaurantImage" style="width: 300px; height: 300px" />
                    <span class="label">${restaurants.rest_name}</span>
                    <span class="labelStar">리뷰</span>
                </div>
            </a>
        `;
        document.querySelector('.restaurantContainer').appendChild(restaurantItem);
    });
            } catch (error) {
                console.error("데이터 가져오기 오류:", error);
            }
        }
</script>

    </body>
</html>
